<?xml version="1.0" encoding="UTF-8" standalone="yes"?>

<template name="Zabbix Events">
    <properties>
        <property name="adaptersDirectoryFullPath" label="Путь к директории адаптеров" format="format"
                  defValue="/home/user007/zsm/adapters"/>
        <property name="adapterDirectory" label="Директория адаптера" format=".*" defValue="camelZabbixMain"
                  unique="true"/>
        <property name="adapterFileName" label="Имя файла адаптера" format=".*" defValue="camelZabbix_main.jar"
                  unique="true"/>
        <property name="adapterTitle" label="Название" format=".*" defValue="Zabbix Event Adapter Main" unique="true"/>
        <property name="adapterName" label="сситемное Имя адаптера" format="[a-z]*" defValue="ZABBIX_EVENT_ADAPTER_MAIN"
                  unique="true"/>
        <property name="adapterDescription" label="Описание" format=".*" defValue="Описание Описание Описание Описание
            \n Описание Описание Описание"/>
        <property name="adapterShFileName" label="Файл управления" format=".*" defValue="ZabbixEventsAdapter_main.sh"
                  unique="true"/>
        <property name="mainLogFile" label="Лог-файл" format=".*" defValue="adapter.log"/>
        <property name="errorLogFile" label="Лог-файл ошибок" format=".*" defValue="errors.log"/>
    </properties>
    <sources>
        <source name="adapterLibsDir" type="dir" target="${adaptersDirectoryFullPath}/${adapterDirectory}">
            templates/zabbixEventsAdapter
        </source>
        <source name="adapterJarFile" type="file"
                target="${adaptersDirectoryFullPath}/${adapterDirectory}/${adapterFileName}">
            templates/zabbixEventsAdapter/camelZabbix.jar
        </source>
        <source name="adapterShFile" type="file" target="${adaptersDirectoryFullPath}/${adapterShFileName}">
            templates/zabbixEventsAdapter/ZabbixEventsAdapter.sh
        </source>
        <source name="adapterLogProperties" type="file"
                target="${adaptersDirectoryFullPath}/${adapterDirectory}/${mainLogFile}">
            templates/zabbixEventsAdapter/log4j.properties
        </source>
        <configs>
            <config id="1">templates/conf/zabbixapi.properties</config>
            <config id="2">templates/sh/ZabbixEventsAdapter.sh</config>
            <config id="3">templates/sh/ZabbixEventsAdapter.sh</config>
        </configs>
    </sources>
    <mainConfigProperties>
        <mainConfigProperty id="1" name="title" description="description1" format="format1">${adapterTitle}
        </mainConfigProperty>
        <mainConfigProperty id="2" name="content" description="description1" format="format1">${adapterDescription}
        </mainConfigProperty>
        <mainConfigProperty id="3" name="jarFileName" description="description1" format="format1">${adapterFileName}
        </mainConfigProperty>
        <mainConfigProperty id="4" name="jarFilePath" description="description1" format="format1">
            ${adaptersDirectoryFullPath}/${adapterDirectory}
        </mainConfigProperty>
        <mainConfigProperty id="5" name="checkStatusCommands" description="description1" format="format1">
            ps -ef | grep -i ${adapterFileName} | grep -v grep
        </mainConfigProperty>
        <mainConfigProperty id="6" name="startCommands" description="description" format="format">
            ${adaptersDirectoryFullPath}/${adapterShFileName} start
        </mainConfigProperty>
        <mainConfigProperty id="7" name="stopCommands" description="description" format="format">
            ${adaptersDirectoryFullPath}/${adapterShFileName} stop
        </mainConfigProperty>
        <mainConfigProperty id="8" name="logFile" description="description" format="format">
            ${adaptersDirectoryFullPath}/${adapterDirectory}/${mainLogFile}
        </mainConfigProperty>
        <mainConfigProperty id="9" name="errorLogFile" description="description" format="format">
            ${adaptersDirectoryFullPath}/${adapterDirectory}/${errorLogFile}
        </mainConfigProperty>
    </mainConfigProperties>
    <configFiles>
        <configFile id="1" configFile="${adaptersDirectoryFullPath}/${adapterDirectory}/zabbixapi.properties"
                    targetEncoding="ISO-8859-1"
                    description="Файл настроек параметров Zabbix ">
            <confProperties>
                <confProperty id="1" label="Период опроса" name="delay" format="^[0-9]{1,5}$">5</confProperty>
                <confProperty id="2" label="URL API zabbix" name="zabbixapiurl" format=".*">
                    http://172.20.19.195/zabbix/api_jsonrpc.php
                </confProperty>
                <confProperty id="3" label="Префикс действий (action) в Zabbix" name="zabbixactionprefix" format=".*">
                    Trigger.Log.XML
                </confProperty>
                <confProperty id="4" label="URL (Namespace) в структуре XML (action)" name="zabbixactionxmlns"
                              format=".*">http://monis.nso.ru/
                </confProperty>
                <confProperty id="5" label="Формат шаблонов Zabbix для выявления типа событий"
                              name="zabbixtemplatepattern" format=".*">.*--(.*)--.*
                </confProperty>
                <confProperty id="6" label="Формат групп хостов для выявления сервиса" name="zabbixtemplatepattern"
                              format=".*">\\((.*)\\)(.*)
                </confProperty>
            </confProperties>

        </configFile>
        <configFile id="2" configFile="${adaptersDirectoryFullPath}/${adapterShFileName}"
                    targetEncoding="UTF-8"
                    description="Файл запуска и остановки процесса адаптера">
            <confProperties>
                <confProperty id="1" label="IP сервера ActiveMQ" name="activemq_ip"
                              format="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$" globalConfig="true">${activemq_ip}
                </confProperty>
                <confProperty id="2" label="Порт сервера ActiveMQ" name="activemq_port" format="^[0-9]{2,5}$"
                              globalConfig="true">${activemq_port}
                </confProperty>
            </confProperties>

        </configFile>
        <configFile id="3" configFile="${adaptersDirectoryFullPath}/${adapterDirectory}/log4j.properties"
                    targetEncoding="UTF-8"
                    description="Файл настройки логирования">
            <confProperties>
                <confProperty id="1" label="label" name="log_level" format="(^INFO$|^DEBUG$)">INFO</confProperty>
                <confProperty id="2" label="label" name="log_file" format="^[\w,\s-]+\.[A-Za-z]{3}$"
                              globalConfig="true">${mainLogFile}
                </confProperty>
            </confProperties>

        </configFile>
    </configFiles>
</template>
